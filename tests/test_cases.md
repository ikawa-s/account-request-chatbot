# テストケース仕様書

アカウント発行依頼チャットボットのテストケース

## テスト環境

- Python 3.10+
- Streamlit
- LangChain + Gemini API
- Trello API（モック可）
- Google Drive API（モック可）

---

## 正常系テストケース

### TC001: Trelloアカウント発行（正常フロー）

**目的**: Trelloアカウントが正常に発行できることを確認

**前提条件**:
- アプリケーションが起動している
- Trello APIの環境変数が設定されている

**テスト手順**:
1. アプリケーションを起動
2. 挨拶メッセージが表示されることを確認
3. メールアドレスを入力: `test@example.com`
4. 「メールアドレス: test@example.com を確認しました」と表示されることを確認
5. ツール選択: `Trello`
6. 「ツール: Trello を確認しました」と表示されることを確認
7. 背景を入力: `プロジェクト管理のために必要です`
8. 「アカウント発行が完了しました！」メッセージが表示されることを確認

**期待結果**:
- ✅ Trello APIが正常に呼び出される
- ✅ 完了メッセージが表示される
- ✅ 新しい依頼の開始を促すメッセージが表示される

---

### TC002: Google Driveアカウント発行（reader権限）

**目的**: Google Driveのreader権限が正常に付与できることを確認

**前提条件**:
- アプリケーションが起動している
- Google Drive APIの環境変数が設定されている
- サービスアカウントがファイルにアクセスできる

**テスト手順**:
1. アプリケーションを起動
2. メールアドレスを入力: `viewer@example.com`
3. ツール選択: `Google Drive`
4. 権限選択: `reader`
5. 背景を入力: `資料を閲覧する必要があります`
6. 「アカウント発行が完了しました！」メッセージが表示されることを確認

**期待結果**:
- ✅ Google Drive APIが正常に呼び出される
- ✅ reader権限が付与される
- ✅ 完了メッセージに「閲覧権限」と表示される

---

### TC003: Google Driveアカウント発行（commenter権限）

**目的**: Google Driveのcommenter権限が正常に付与できることを確認

**前提条件**:
- アプリケーションが起動している
- Google Drive APIの環境変数が設定されている

**テスト手順**:
1. メールアドレスを入力: `commenter@example.com`
2. ツール選択: `Google Drive`
3. 権限選択: `commenter`
4. 背景を入力: `コメントを追加する必要があります`

**期待結果**:
- ✅ commenter権限が付与される
- ✅ 完了メッセージに「コメント権限」と表示される

---

### TC004: Google Driveアカウント発行（writer権限）

**目的**: Google Driveのwriter権限が正常に付与できることを確認

**前提条件**:
- アプリケーションが起動している
- Google Drive APIの環境変数が設定されている

**テスト手順**:
1. メールアドレスを入力: `editor@example.com`
2. ツール選択: `Google Drive`
3. 権限選択: `writer`
4. 背景を入力: `資料を編集する必要があります`

**期待結果**:
- ✅ writer権限が付与される
- ✅ 完了メッセージに「編集権限」と表示される

---

### TC005: 会話のリセット

**目的**: 会話をリセットして新しい依頼を開始できることを確認

**前提条件**:
- 1件のアカウント発行が完了している

**テスト手順**:
1. サイドバーの「会話をリセット」ボタンをクリック
2. 会話履歴がクリアされることを確認
3. 挨拶メッセージが再度表示されることを確認
4. 新しいメールアドレスで依頼を開始できることを確認

**期待結果**:
- ✅ 会話履歴がクリアされる
- ✅ 状態がリセットされる
- ✅ 新しい依頼を開始できる

---

## 異常系テストケース

### TC101: 不正なメールアドレス形式（@なし）

**目的**: 不正なメールアドレスが検証されることを確認

**テスト手順**:
1. メールアドレスを入力: `invalid-email`

**期待結果**:
- ❌ メールアドレスとして認識されない
- ✅ 再度メールアドレスの入力を促される

---

### TC102: 不正なメールアドレス形式（ドメインなし）

**目的**: ドメインがないメールアドレスが検証されることを確認

**テスト手順**:
1. メールアドレスを入力: `test@`

**期待結果**:
- ❌ メールアドレスとして認識されない
- ✅ 再度メールアドレスの入力を促される

---

### TC103: メールアドレスが空

**目的**: 空のメールアドレスが検証されることを確認

**テスト手順**:
1. メールアドレスを入力: ` `（スペースのみ）

**期待結果**:
- ❌ メールアドレスとして認識されない
- ✅ メールアドレスの入力を促される

---

### TC104: 背景が255文字超過

**目的**: 背景の文字数制限が機能することを確認

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Trello`
3. 背景を入力: 256文字以上の文字列

**期待結果**:
- ❌ バリデーションエラーが発生
- ✅ 「背景は255文字以内で入力してください」というエラーメッセージが表示される
- ✅ 現在の文字数が表示される

---

### TC105: 背景が空

**目的**: 空の背景が検証されることを確認

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Trello`
3. 背景を入力: ` `（スペースのみ）

**期待結果**:
- ❌ バリデーションエラーが発生
- ✅ 「背景を入力してください」というエラーメッセージが表示される

---

### TC106: 不正なツール名

**目的**: サポートされていないツールが検証されることを確認

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Slack`（サポート外）

**期待結果**:
- ❌ ツールとして認識されない
- ✅ 再度ツール選択を促される

---

### TC107: Google Driveで権限未選択

**目的**: Google Driveで権限が必須であることを確認

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Google Drive`
3. 背景を入力（権限を選択せずに）: `資料にアクセスしたいです`

**期待結果**:
- ❌ 権限が選択されていない
- ✅ 権限の選択を促される

---

### TC108: Trello API エラー（無効なAPIキー）

**目的**: Trello APIエラーが適切に処理されることを確認

**前提条件**:
- Trello APIキーが無効

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Trello`
3. 背景を入力: `プロジェクト管理のため`

**期待結果**:
- ❌ Trello API呼び出しが失敗
- ✅ エラーメッセージが表示される
- ✅ 「もう一度お試しいただくか、管理者にお問い合わせください」と表示される

---

### TC109: Google Drive API エラー（ファイルが見つからない）

**目的**: Google Drive APIエラーが適切に処理されることを確認

**前提条件**:
- GOOGLE_DRIVE_FILE_IDが無効

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Google Drive`
3. 権限選択: `reader`
4. 背景を入力: `資料を閲覧したい`

**期待結果**:
- ❌ Google Drive API呼び出しが失敗
- ✅ 「ファイルが見つかりません」というエラーメッセージが表示される
- ✅ 「GOOGLE_DRIVE_FILE_IDを確認してください」と表示される

---

### TC110: Google Drive API エラー（権限不足）

**目的**: サービスアカウントの権限不足が適切に処理されることを確認

**前提条件**:
- サービスアカウントがファイルにアクセスできない

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Google Drive`
3. 権限選択: `reader`
4. 背景を入力: `資料を閲覧したい`

**期待結果**:
- ❌ Google Drive API呼び出しが失敗
- ✅ 「権限がありません」というエラーメッセージが表示される

---

### TC111: 環境変数未設定（Gemini API）

**目的**: 必須環境変数が未設定の場合のエラー処理を確認

**前提条件**:
- GEMINI_API_KEYが未設定

**テスト手順**:
1. アプリケーションを起動

**期待結果**:
- ❌ アプリケーションが起動に失敗
- ✅ 「GEMINI_API_KEY が設定されていません」というエラーメッセージが表示される

---

### TC112: 環境変数未設定（Trello API）

**目的**: Trello APIの環境変数が未設定の場合のエラー処理を確認

**前提条件**:
- TRELLO_API_KEYまたはTRELLO_API_TOKENが未設定

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Trello`
3. 背景を入力: `プロジェクト管理のため`

**期待結果**:
- ❌ Trello APIクライアントの初期化に失敗
- ✅ 「Trello API の環境変数が設定されていません」というエラーメッセージが表示される

---

### TC113: サービスアカウントファイルが見つからない

**目的**: サービスアカウントファイルが存在しない場合のエラー処理を確認

**前提条件**:
- GOOGLE_SERVICE_ACCOUNT_JSONが無効なパス

**テスト手順**:
1. メールアドレスを入力: `test@example.com`
2. ツール選択: `Google Drive`
3. 権限選択: `reader`
4. 背景を入力: `資料を閲覧したい`

**期待結果**:
- ❌ Google Drive APIクライアントの初期化に失敗
- ✅ 「サービスアカウントファイルが見つかりません」というエラーメッセージが表示される

---

## パフォーマンステストケース

### TC201: 連続依頼処理

**目的**: 複数の依頼を連続で処理できることを確認

**テスト手順**:
1. 1件目の依頼を完了
2. 2件目のメールアドレスを入力
3. 2件目の依頼を完了
4. 3件目の依頼を開始

**期待結果**:
- ✅ 複数の依頼を連続で処理できる
- ✅ 各依頼が独立して処理される
- ✅ 会話履歴が正しく保持される

---

### TC202: 大量の会話履歴

**目的**: 長い会話でもパフォーマンスが劣化しないことを確認

**テスト手順**:
1. 10件以上の依頼を連続で処理
2. 各依頼の処理時間を計測

**期待結果**:
- ✅ 処理時間が大幅に増加しない
- ✅ メモリ使用量が急増しない

---

## セキュリティテストケース

### TC301: SQLインジェクション対策

**目的**: SQLインジェクションが防止されることを確認

**テスト手順**:
1. メールアドレスを入力: `test@example.com'; DROP TABLE users; --`
2. 背景を入力: `'; DELETE FROM accounts; --`

**期待結果**:
- ✅ 入力がサニタイズされる
- ✅ SQLインジェクションが実行されない

---

### TC302: XSS対策

**目的**: クロスサイトスクリプティングが防止されることを確認

**テスト手順**:
1. メールアドレスを入力: `<script>alert('XSS')</script>@example.com`
2. 背景を入力: `<img src=x onerror=alert('XSS')>`

**期待結果**:
- ✅ スクリプトが実行されない
- ✅ HTMLがエスケープされる

---

### TC303: 環境変数の漏洩防止

**目的**: エラーメッセージに機密情報が含まれないことを確認

**テスト手順**:
1. 意図的にAPIエラーを発生させる
2. エラーメッセージを確認

**期待結果**:
- ✅ APIキーが表示されない
- ✅ トークンが表示されない
- ✅ パスワードが表示されない

---

## ブラウザ互換性テストケース

### TC401: Chrome

**期待結果**:
- ✅ 正常に動作する

### TC402: Firefox

**期待結果**:
- ✅ 正常に動作する

### TC403: Safari

**期待結果**:
- ✅ 正常に動作する

### TC404: Edge

**期待結果**:
- ✅ 正常に動作する

---

## モバイル対応テストケース

### TC501: スマートフォン（縦向き）

**期待結果**:
- ✅ レイアウトが適切に調整される
- ✅ チャット入力が使いやすい

### TC502: タブレット

**期待結果**:
- ✅ レイアウトが適切に調整される
- ✅ サイドバーが適切に表示される

---

## まとめ

**合計テストケース数**: 30+

**優先度**:
- 🔴 高: TC001-TC005（正常系）, TC101-TC113（異常系）
- 🟡 中: TC201-TC202（パフォーマンス）
- 🟢 低: TC301-TC502（セキュリティ、互換性）

**実行頻度**:
- リリース前: 全テストケース
- 定期CI/CD: TC001-TC113
- 手動確認: TC401-TC502
